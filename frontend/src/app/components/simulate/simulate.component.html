<div class="simulate-container">
  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="isLoadingTranslations">
    <div class="loading-spinner">
      <svg
        class="spinner"
        width="40"
        height="40"
        viewBox="0 0 24 24"
        fill="none"
      >
        <circle
          cx="12"
          cy="12"
          r="10"
          stroke="currentColor"
          stroke-width="4"
          stroke-opacity="0.25"
        ></circle>
        <path
          fill="currentColor"
          d="M4 12a8 8 0 0 1 8-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 0 1 4 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
        ></path>
      </svg>
      <p *ngIf="currentLanguage === 'pt-br'">Carregando traduções...</p>
      <p *ngIf="currentLanguage === 'en'">Loading translations...</p>
    </div>
  </div>

  <!-- Language Selector -->
  <div class="language-selector">
    <select
      class="language-dropdown"
      [ngModel]="currentLanguage"
      (ngModelChange)="switchLanguage($event)"
      [disabled]="isLoadingTranslations"
    >
      <option *ngFor="let lang of languages" [value]="lang.code">
        {{ lang.flag }} {{ lang.name }}
      </option>
    </select>
  </div>

  <!-- Header -->
  <div class="header" *ngIf="!isLoadingTranslations">
    <h1 class="title">{{ "title" | translate }}</h1>
    <p class="subtitle">{{ "subtitle" | translate }}</p>
  </div>

  <!-- Form Section -->
  <div class="form-section" *ngIf="!isLoadingTranslations">
    <form
      [formGroup]="simulateForm"
      (ngSubmit)="onSubmit()"
      class="simulate-form"
    >
      <!-- Job Information -->
      <div class="form-group">
        <label for="jobTitle" class="form-label">
          {{ "form.jobTitle" | translate }}
          <span class="required">{{ "form.required" | translate }}</span>
        </label>
        <input
          type="text"
          id="jobTitle"
          formControlName="jobTitle"
          class="form-input"
          [placeholder]="'form.jobTitlePlaceholder' | translate"
          [class.error]="
            simulateForm.get('jobTitle')?.invalid &&
            simulateForm.get('jobTitle')?.touched
          "
        />
        <div
          class="error-message"
          *ngIf="
            simulateForm.get('jobTitle')?.invalid &&
            simulateForm.get('jobTitle')?.touched
          "
        >
          {{ "form.jobTitleRequired" | translate }}
        </div>
      </div>

      <div class="form-group">
        <label for="jobDescription" class="form-label">
          {{ "form.jobDescription" | translate }}
        </label>
        <textarea
          id="jobDescription"
          formControlName="jobDescription"
          class="form-textarea"
          rows="4"
          [placeholder]="'form.jobDescriptionPlaceholder' | translate"
        ></textarea>
      </div>

      <div class="form-group">
        <label for="experienceLevel" class="form-label">
          {{ "form.experienceLevel" | translate }}
          <span class="required">{{ "form.required" | translate }}</span>
        </label>
        <select
          id="experienceLevel"
          formControlName="experienceLevel"
          class="form-select"
        >
          <option *ngFor="let level of experienceLevels" [value]="level.value">
            {{ level.label }}
          </option>
        </select>
      </div>

      <!-- Resume Input Method Toggle -->
      <div class="form-group">
        <label class="form-label">
          {{ "form.resumeInputMethod" | translate }}
          <span class="required">{{ "form.required" | translate }}</span>
        </label>
        <div class="input-method-toggle">
          <button
            type="button"
            class="toggle-btn"
            [class.active]="resumeInputMethod === 'text'"
            (click)="switchInputMethod('text')"
          >
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
              ></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            {{ "form.pasteText" | translate }}
          </button>
          <button
            type="button"
            class="toggle-btn"
            [class.active]="resumeInputMethod === 'pdf'"
            (click)="switchInputMethod('pdf')"
          >
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
              ></path>
              <polyline points="14 2 14 8 20 8"></polyline>
            </svg>
            {{ "form.uploadPdf" | translate }}
          </button>
        </div>
      </div>

      <!-- Resume Text Input -->
      <div class="form-group" *ngIf="resumeInputMethod === 'text'">
        <label for="resumeText" class="form-label">
          {{ "form.resumeText" | translate }}
          <span class="required">{{ "form.required" | translate }}</span>
        </label>
        <textarea
          id="resumeText"
          formControlName="resumeText"
          class="form-textarea"
          rows="10"
          [placeholder]="'form.resumeTextPlaceholder' | translate"
          [class.error]="
            simulateForm.get('resumeText')?.invalid &&
            simulateForm.get('resumeText')?.touched
          "
        ></textarea>
        <div
          class="error-message"
          *ngIf="
            simulateForm.get('resumeText')?.invalid &&
            simulateForm.get('resumeText')?.touched
          "
        >
          {{ "form.resumeTextRequired" | translate }}
        </div>
      </div>

      <!-- PDF Upload Input -->
      <div class="form-group" *ngIf="resumeInputMethod === 'pdf'">
        <label for="pdfFile" class="form-label">
          {{ "form.pdfFile" | translate }}
          <span class="required">{{ "form.required" | translate }}</span>
        </label>
        <div class="file-upload-area" [class.has-file]="selectedFile">
          <input
            type="file"
            id="pdfFile"
            accept=".pdf"
            (change)="onFileSelected($event)"
            class="file-input"
          />
          <div class="file-upload-content" *ngIf="!selectedFile">
            <svg
              width="48"
              height="48"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
            <p class="upload-text">
              {{ "form.uploadText" | translate }}
            </p>
            <p class="upload-hint">{{ "form.uploadHint" | translate }}</p>
          </div>
          <div class="file-selected" *ngIf="selectedFile">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
              ></path>
              <polyline points="14 2 14 8 20 8"></polyline>
            </svg>
            <span class="file-name">{{ fileName }}</span>
            <button
              type="button"
              class="remove-file-btn"
              (click)="removeFile()"
            >
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Error Message -->
      <div class="error-alert" *ngIf="error">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        {{ error }}
      </div>

      <!-- Submit Button -->
      <div class="form-actions">
        <button
          type="submit"
          class="submit-btn"
          [disabled]="
            isLoading ||
            simulateForm.invalid ||
            (resumeInputMethod === 'pdf' && !selectedFile)
          "
        >
          <span *ngIf="!isLoading">{{ "form.submit" | translate }}</span>
          <span *ngIf="isLoading" class="loading">
            <svg
              class="spinner"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
            >
              <circle
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                stroke-width="4"
                stroke-opacity="0.25"
              ></circle>
              <path
                fill="currentColor"
                d="M4 12a8 8 0 0 1 8-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 0 1 4 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
              ></path>
            </svg>
            {{ "form.processing" | translate }}
          </span>
        </button>
        <button
          type="button"
          class="reset-btn"
          (click)="resetForm()"
          [disabled]="isLoading"
        >
          {{ "form.clear" | translate }}
        </button>
      </div>
    </form>
  </div>

  <!-- Results Section -->
  <div
    id="result-section"
    class="results-section"
    *ngIf="result && !isLoadingTranslations"
  >
    <h2 class="results-title">{{ "results.title" | translate }}</h2>

    <!-- Score Card -->
    <div class="score-card">
      <div
        class="score-circle"
        [class]="'score-' + getScoreColor(result.atsScore)"
      >
        <span class="score-value">{{ result.atsScore }}</span>
        <span class="score-label">{{ "results.atsScore" | translate }}</span>
      </div>
      <div class="score-info">
        <h3>{{ "results.atsScore" | translate }}</h3>
        <p>
          {{ "results.atsScoreDescription" | translate }}
        </p>
      </div>
    </div>

    <!-- Decision Card -->
    <div
      class="decision-card"
      [class]="'decision-' + getDecisionColor(result.finalDecision.decision)"
    >
      <div class="decision-header">
        <h3>{{ "results.finalDecision" | translate }}</h3>
        <span class="decision-badge">{{
          translateDecision(result.finalDecision.decision)
        }}</span>
      </div>
      <p class="decision-justification">
        {{ result.finalDecision.justification }}
      </p>
    </div>

    <!-- ATS Analysis -->
    <div class="analysis-card">
      <h3 class="card-title">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M9 11l3 3L22 4"></path>
          <path
            d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"
          ></path>
        </svg>
        {{ "results.atsAnalysis" | translate }}
      </h3>
      <div class="keywords-section">
        <div class="keywords-group">
          <h4>{{ "results.keywordsMatched" | translate }}</h4>
          <div class="keywords-list">
            <span
              class="keyword-tag matched"
              *ngFor="let keyword of result.atsAnalysis.keywordsMatched"
            >
              {{ keyword }}
            </span>
            <span
              class="no-keywords"
              *ngIf="result.atsAnalysis.keywordsMatched.length === 0"
            >
              {{ "results.noKeywordsFound" | translate }}
            </span>
          </div>
        </div>
        <div class="keywords-group">
          <h4>{{ "results.keywordsMissing" | translate }}</h4>
          <div class="keywords-list">
            <span
              class="keyword-tag missing"
              *ngFor="let keyword of result.atsAnalysis.keywordsMissing"
            >
              {{ keyword }}
            </span>
            <span
              class="no-keywords"
              *ngIf="result.atsAnalysis.keywordsMissing.length === 0"
            >
              {{ "results.allKeywordsFound" | translate }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Technical Evaluation -->
    <div class="analysis-card">
      <h3 class="card-title">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
        </svg>
        {{ "results.technicalEvaluation" | translate }}
      </h3>
      <div class="evaluation-content">
        <div class="evaluation-item">
          <h4>{{ "results.perceivedSeniority" | translate }}</h4>
          <span class="seniority-badge">{{
            result.technicalEvaluation.perceivedSeniority
          }}</span>
        </div>
        <div
          class="evaluation-item"
          *ngIf="result.technicalEvaluation.strengths.length > 0"
        >
          <h4>{{ "results.strengths" | translate }}</h4>
          <ul class="evaluation-list strengths">
            <li *ngFor="let strength of result.technicalEvaluation.strengths">
              {{ strength }}
            </li>
          </ul>
        </div>
        <div
          class="evaluation-item"
          *ngIf="result.technicalEvaluation.risks.length > 0"
        >
          <h4>{{ "results.risks" | translate }}</h4>
          <ul class="evaluation-list risks">
            <li *ngFor="let risk of result.technicalEvaluation.risks">
              {{ risk }}
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- HR Evaluation -->
    <div class="analysis-card">
      <h3 class="card-title">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
        {{ "results.hrEvaluation" | translate }}
      </h3>
      <div class="evaluation-content">
        <div class="evaluation-item">
          <h4>{{ "results.communication" | translate }}</h4>
          <span class="evaluation-value">{{
            result.hrEvaluation.communication
          }}</span>
        </div>
        <div class="evaluation-item">
          <h4>{{ "results.clarity" | translate }}</h4>
          <span class="evaluation-value">{{
            result.hrEvaluation.clarity
          }}</span>
        </div>
        <div
          class="evaluation-item"
          *ngIf="result.hrEvaluation.redFlags.length > 0"
        >
          <h4>{{ "results.redFlags" | translate }}</h4>
          <ul class="evaluation-list red-flags">
            <li *ngFor="let flag of result.hrEvaluation.redFlags">
              {{ flag }}
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Suggestions -->
    <div class="analysis-card suggestions-card">
      <h3 class="card-title">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="16" x2="12" y2="12"></line>
          <line x1="12" y1="8" x2="12.01" y2="8"></line>
        </svg>
        {{ "results.suggestions" | translate }}
      </h3>
      <ul class="suggestions-list">
        <li *ngFor="let suggestion of result.resumeSuggestions">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="9 11 12 14 22 4"></polyline>
            <path
              d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"
            ></path>
          </svg>
          {{ suggestion }}
        </li>
      </ul>
    </div>
  </div>
</div>
